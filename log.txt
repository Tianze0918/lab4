

1. Baseline 
    throughput = 41104179200/7323752913 = 5.612
    DSP: 72
2. Unrolling innermost p and q loop with unroll factor equal to 5ã€‚
    throughput: 41104179200/6632860114 = 6.197
    DSP: 71    
3. Pipelining the width loop:
    throughput: 41104179200/311007698 = 132.1645074
    
    Pipelining p q instead of full unroll:
    throughput: 41104179200/311007698 = 132.1645074

4. Changing the HLS array partition of the input into 5 elements for the innermost dimension
    throughput: 41104179200/266414546 = 154.286
    
5. Unroll (16) and pipeline width loop:

6. pipelining w loop, fully unroll p and q:
    throughput = 41104179200/261798354 = 157

7. pipelining w loop, fully unroll p and q, weight factor moved from 1to 5:
    305838546
    throughput = 41104179200/305838546 = 134.3
    Why did a increased cyclic factor lead to longerlatency? 
        The unroll inside p and q have dependency, and to make consecutive p and q fit into onecycle, the pipeline will longer
        and the latency for one i,h,w jump from time for one multiply and add into 25 multiply and add

    41104179200/878352850
    41104179200/6632937938





1. unrolling p, q, default partition 
    41104179200/6632937938 = 6.197
2. unrolling p, q, partition p, q = 5
    41104179200/3344603602 = 12.289
3. unrolling p, q, partition p, q complete
    41104179200/3344603602 = 12.289
4. unrolling p, q, partition p, q complete, output dimension 3 = 1
    41104179200/3355007442 =  12.251
5. unrolling p, q, partition p, q complete, output dimension 3 = 1, input dimension 2/3 = 5
    41104179200/3355011538 = 12.251
    This step takes significantly longer. (129 S compares to usual 60 S)
    ================================================================
    == Utilization Estimates
    ================================================================
    * Summary: 
    +---------------------+---------+------+---------+---------+-----+
    |         Name        | BRAM_18K|  DSP |    FF   |   LUT   | URAM|
    +---------------------+---------+------+---------+---------+-----+
    |DSP                  |        -|     -|        -|        -|    -|
    |Expression           |        -|     -|        0|        2|    -|
    |FIFO                 |        -|     -|        -|        -|    -|
    |Instance             |       40|   129|    25446|    28905|    0|
    |Memory               |     1568|     -|        0|        0|   50|
    |Multiplexer          |        -|     -|        -|      104|    -|
    |Register             |        -|     -|      199|        -|    -|
    +---------------------+---------+------+---------+---------+-----+
    |Total                |     1608|   129|    25645|    29011|   50|
    +---------------------+---------+------+---------+---------+-----+
    |Available SLR        |     1440|  2280|   788160|   394080|  320|
    +---------------------+---------+------+---------+---------+-----+
    |Utilization SLR (%)  |      111|     5|        3|        7|   15|
    +---------------------+---------+------+---------+---------+-----+
    |Available            |     4320|  6840|  2364480|  1182240|  960|
    +---------------------+---------+------+---------+---------+-----+
    |Utilization (%)      |       37|     1|        1|        2|    5|
    +---------------------+---------+------+---------+---------+-----+

6. unrolling p, q, partition p, q complete, output dimension 3 = 1, input dimension 2/3 = 5, unrolling w loop by factor 2
    Elapsed time = 131 
    41104179200/3355015634 = 12.251
    ================================================================
    == Utilization Estimates
    ================================================================
    * Summary: 
    +---------------------+---------+------+---------+---------+-----+
    |         Name        | BRAM_18K|  DSP |    FF   |   LUT   | URAM|
    +---------------------+---------+------+---------+---------+-----+
    |DSP                  |        -|     -|        -|        -|    -|
    |Expression           |        -|     -|        0|        2|    -|
    |FIFO                 |        -|     -|        -|        -|    -|
    |Instance             |       40|   129|    29293|    31976|    0|
    |Memory               |     1568|     -|        0|        0|   50|
    |Multiplexer          |        -|     -|        -|      104|    -|
    |Register             |        -|     -|      199|        -|    -|
    +---------------------+---------+------+---------+---------+-----+
    |Total                |     1608|   129|    29492|    32082|   50|
    +---------------------+---------+------+---------+---------+-----+
    |Available SLR        |     1440|  2280|   788160|   394080|  320|
    +---------------------+---------+------+---------+---------+-----+
    |Utilization SLR (%)  |      111|     5|        3|        8|   15|
    +---------------------+---------+------+---------+---------+-----+
    |Available            |     4320|  6840|  2364480|  1182240|  960|
    +---------------------+---------+------+---------+---------+-----+
    |Utilization (%)      |       37|     1|        1|        2|    5|
    +---------------------+---------+------+---------+---------+-----+

7. unrolling p, q, partition p, q complete, output dimension 3 = 1, input dimension 2/3 = 5, unrolling w loop by factor 4
    41104179200/3355040210= 12.251
    Elapsed time = 336
    +---------------------+---------+------+---------+---------+-----+
    |         Name        | BRAM_18K|  DSP |    FF   |   LUT   | URAM|
    +---------------------+---------+------+---------+---------+-----+
    |DSP                  |        -|     -|        -|        -|    -|
    |Expression           |        -|     -|        0|        2|    -|
    |FIFO                 |        -|     -|        -|        -|    -|
    |Instance             |       40|   130|    33899|    35558|    0|
    |Memory               |     1568|     -|        0|        0|   50|
    |Multiplexer          |        -|     -|        -|      104|    -|
    |Register             |        -|     -|      199|        -|    -|
    +---------------------+---------+------+---------+---------+-----+
    |Total                |     1608|   130|    34098|    35664|   50|
    +---------------------+---------+------+---------+---------+-----+
    |Available SLR        |     1440|  2280|   788160|   394080|  320|
    +---------------------+---------+------+---------+---------+-----+
    |Utilization SLR (%)  |      111|     5|        4|        9|   15|
    +---------------------+---------+------+---------+---------+-----+
    |Available            |     4320|  6840|  2364480|  1182240|  960|
    +---------------------+---------+------+---------+---------+-----+
    |Utilization (%)      |       37|     1|        1|        3|    5|
    +---------------------+---------+------+---------+---------+-----+

8. unrolling p, q, partition p, q complete, output dimension 3 = 1, input dimension 2/3 = 5, unrolling w loop by factor 4. Permuting H and W loop, 
    41104179200/3355040210= 12.251
    Elapsed time = 189.33
    ================================================================
    == Utilization Estimates
    ================================================================
    * Summary: 
    +---------------------+---------+------+---------+---------+-----+
    |         Name        | BRAM_18K|  DSP |    FF   |   LUT   | URAM|
    +---------------------+---------+------+---------+---------+-----+
    |DSP                  |        -|     -|        -|        -|    -|
    |Expression           |        -|     -|        0|        2|    -|
    |FIFO                 |        -|     -|        -|        -|    -|
    |Instance             |       40|   130|    34111|    36110|    0|
    |Memory               |     1568|     -|        0|        0|   50|
    |Multiplexer          |        -|     -|        -|      104|    -|
    |Register             |        -|     -|      199|        -|    -|
    +---------------------+---------+------+---------+---------+-----+
    |Total                |     1608|   130|    34310|    36216|   50|
    +---------------------+---------+------+---------+---------+-----+
    |Available SLR        |     1440|  2280|   788160|   394080|  320|
    +---------------------+---------+------+---------+---------+-----+
    |Utilization SLR (%)  |      111|     5|        4|        9|   15|
    +---------------------+---------+------+---------+---------+-----+
    |Available            |     4320|  6840|  2364480|  1182240|  960|
    +---------------------+---------+------+---------+---------+-----+
    |Utilization (%)      |       37|     1|        1|        3|    5|
    +---------------------+---------+------+---------+---------+-----+

9. unrolling p, q, partition p, q complete, output dimension 3 = 1, input dimension 2/3 = 5, unrolling w loop by factor 5. Permuting H and W loop, 
    41104179200/3355040210= 12.251
    Elapsed time = 184.33
    ================================================================
    == Utilization Estimates
    ================================================================
    * Summary: 
    +---------------------+---------+------+---------+---------+-----+
    |         Name        | BRAM_18K|  DSP |    FF   |   LUT   | URAM|
    +---------------------+---------+------+---------+---------+-----+
    |DSP                  |        -|     -|        -|        -|    -|
    |Expression           |        -|     -|        0|        2|    -|
    |FIFO                 |        -|     -|        -|        -|    -|
    |Instance             |       40|   130|    34111|    36110|    0|
    |Memory               |     1568|     -|        0|        0|   50|
    |Multiplexer          |        -|     -|        -|      104|    -|
    |Register             |        -|     -|      199|        -|    -|
    +---------------------+---------+------+---------+---------+-----+
    |Total                |     1608|   130|    34310|    36216|   50|
    +---------------------+---------+------+---------+---------+-----+
    |Available SLR        |     1440|  2280|   788160|   394080|  320|
    +---------------------+---------+------+---------+---------+-----+
    |Utilization SLR (%)  |      111|     5|        4|        9|   15|
    +---------------------+---------+------+---------+---------+-----+
    |Available            |     4320|  6840|  2364480|  1182240|  960|
    +---------------------+---------+------+---------+---------+-----+
    |Utilization (%)      |       37|     1|        1|        3|    5|
    +---------------------+---------+------+---------+---------+-----+

10. unrolling p, q, partition p, q complete, output dimension 3 = 1, input dimension 2/3 = 5, unrolling w loop by factor 5. Permuting H and W loop, used accumualtor for output[i1][h][w]
    41104179200/3355011538 = 12.2515761077
    ================================================================
    == Utilization Estimates
    ================================================================
    * Summary: 
    +---------------------+---------+------+---------+---------+-----+
    |         Name        | BRAM_18K|  DSP |    FF   |   LUT   | URAM|
    +---------------------+---------+------+---------+---------+-----+
    |DSP                  |        -|     -|        -|        -|    -|
    |Expression           |        -|     -|        0|        2|    -|
    |FIFO                 |        -|     -|        -|        -|    -|
    |Instance             |       40|   129|    25446|    28905|    0|
    |Memory               |     1568|     -|        0|        0|   50|
    |Multiplexer          |        -|     -|        -|      104|    -|
    |Register             |        -|     -|      199|        -|    -|
    +---------------------+---------+------+---------+---------+-----+
    |Total                |     1608|   129|    25645|    29011|   50|
    +---------------------+---------+------+---------+---------+-----+
    |Available SLR        |     1440|  2280|   788160|   394080|  320|
    +---------------------+---------+------+---------+---------+-----+
    |Utilization SLR (%)  |      111|     5|        3|        7|   15|
    +---------------------+---------+------+---------+---------+-----+
    |Available            |     4320|  6840|  2364480|  1182240|  960|
    +---------------------+---------+------+---------+---------+-----+
    |Utilization (%)      |       37|     1|        1|        2|    5|
    +---------------------+---------+------+---------+---------+-----+

11. unrolling p, q, partition p, q complete, output dimension 3 = 1, input dimension 2/3 = 5, used accumualtor for output[i1][h][w], pipelined w, made h,w iteration's needed input register 
    Notable time difference: 46.02 S
    41104179200/4734708178 = 8.681
    ================================================================
    == Utilization Estimates
    ================================================================
    * Summary: 
    +---------------------+---------+------+---------+---------+-----+
    |         Name        | BRAM_18K|  DSP |    FF   |   LUT   | URAM|
    +---------------------+---------+------+---------+---------+-----+
    |DSP                  |        -|     -|        -|        -|    -|
    |Expression           |        -|     -|        0|        2|    -|
    |FIFO                 |        -|     -|        -|        -|    -|
    |Instance             |       40|   129|    25446|    28905|    0|
    |Memory               |     1568|     -|        0|        0|   50|
    |Multiplexer          |        -|     -|        -|      104|    -|
    |Register             |        -|     -|      199|        -|    -|
    +---------------------+---------+------+---------+---------+-----+
    |Total                |     1608|   129|    25645|    29011|   50|
    +---------------------+---------+------+---------+---------+-----+
    |Available SLR        |     1440|  2280|   788160|   394080|  320|
    +---------------------+---------+------+---------+---------+-----+
    |Utilization SLR (%)  |      111|     5|        3|        7|   15|
    +---------------------+---------+------+---------+---------+-----+
    |Available            |     4320|  6840|  2364480|  1182240|  960|
    +---------------------+---------+------+---------+---------+-----+
    |Utilization (%)      |       37|     1|        1|        2|    5|
    +---------------------+---------+------+---------+---------+-----+

12.  unrolling p, q, partition p, q complete, output dimension 3 = 1, input dimension 2/3 = 5, used accumualtor for output[i1][h][w], pipelined w, made h,w iteration's needed input register, permuted the i1 loop 
    Elapsed time: 259.51 S
    41104179200/3447450066 = 11.92
    ================================================================
    == Utilization Estimates
    ================================================================
    * Summary: 
    +---------------------+---------+------+---------+---------+-----+
    |         Name        | BRAM_18K|  DSP |    FF   |   LUT   | URAM|
    +---------------------+---------+------+---------+---------+-----+
    |DSP                  |        -|     -|        -|        -|    -|
    |Expression           |        -|     -|        0|        2|    -|
    |FIFO                 |        -|     -|        -|        -|    -|
    |Instance             |       40|   129|    55889|    50613|    0|
    |Memory               |     1968|     -|        0|        0|   25|
    |Multiplexer          |        -|     -|        -|      104|    -|
    |Register             |        -|     -|      199|        -|    -|
    +---------------------+---------+------+---------+---------+-----+
    |Total                |     2008|   129|    56088|    50719|   25|
    +---------------------+---------+------+---------+---------+-----+
    |Available SLR        |     1440|  2280|   788160|   394080|  320|
    +---------------------+---------+------+---------+---------+-----+
    |Utilization SLR (%)  |      139|     5|        7|       12|    7|
    +---------------------+---------+------+---------+---------+-----+
    |Available            |     4320|  6840|  2364480|  1182240|  960|
    +---------------------+---------+------+---------+---------+-----+
    |Utilization (%)      |       46|     1|        2|        4|    2|
    +---------------------+---------+------+---------+---------+-----+

13. unrolling p, q, partition p, q complete, output dimension 1 = 16, input dimension 2/3 = 5, used accumualtor for output[i1][h][w], pipelined w, made h,w iteration's needed input register, permuted the i1 loop 
    Elapsed time: 88.98 S
    41104179200/349956562 = 117.46
    ================================================================
    == Utilization Estimates
    ================================================================
    * Summary: 
    +---------------------+---------+------+---------+---------+-----+
    |         Name        | BRAM_18K|  DSP |    FF   |   LUT   | URAM|
    +---------------------+---------+------+---------+---------+-----+
    |DSP                  |        -|     -|        -|        -|    -|
    |Expression           |        -|     -|        0|        2|    -|
    |FIFO                 |        -|     -|        -|        -|    -|
    |Instance             |       40|  2004|   236524|   149933|    0|
    |Memory               |     1968|     -|        0|        0|   25|
    |Multiplexer          |        -|     -|        -|      104|    -|
    |Register             |        -|     -|      199|        -|    -|
    +---------------------+---------+------+---------+---------+-----+
    |Total                |     2008|  2004|   236723|   150039|   25|
    +---------------------+---------+------+---------+---------+-----+
    |Available SLR        |     1440|  2280|   788160|   394080|  320|
    +---------------------+---------+------+---------+---------+-----+
    |Utilization SLR (%)  |      139|    87|       30|       38|    7|
    +---------------------+---------+------+---------+---------+-----+
    |Available            |     4320|  6840|  2364480|  1182240|  960|
    +---------------------+---------+------+---------+---------+-----+
    |Utilization (%)      |       46|    29|       10|       12|    2|
    +---------------------+---------+------+---------+---------+-----+

14. unrolling p, q, partition p, q complete, output dimension 1 = 16, input dimension 2/3 = 5, used accumualtor for output[i1][h][w], pipelined w, made h,w iteration's needed input register, permuted the i1 loop, unrolled w loop by 4.
    Elapsed time: 160.21 S
    41104179200/256371154 = 160.33

    ================================================================
    == Utilization Estimates
    ================================================================
    * Summary: 
    +---------------------+---------+------+---------+---------+-----+
    |         Name        | BRAM_18K|  DSP |    FF   |   LUT   | URAM|
    +---------------------+---------+------+---------+---------+-----+
    |DSP                  |        -|     -|        -|        -|    -|
    |Expression           |        -|     -|        0|        2|    -|
    |FIFO                 |        -|     -|        -|        -|    -|
    |Instance             |       40|  4004|   528879|   325684|    0|
    |Memory               |     1968|     -|        0|        0|   25|
    |Multiplexer          |        -|     -|        -|      104|    -|
    |Register             |        -|     -|      199|        -|    -|
    +---------------------+---------+------+---------+---------+-----+
    |Total                |     2008|  4004|   529078|   325790|   25|
    +---------------------+---------+------+---------+---------+-----+
    |Available SLR        |     1440|  2280|   788160|   394080|  320|
    +---------------------+---------+------+---------+---------+-----+
    |Utilization SLR (%)  |      139|   175|       67|       82|    7|
    +---------------------+---------+------+---------+---------+-----+
    |Available            |     4320|  6840|  2364480|  1182240|  960|
    +---------------------+---------+------+---------+---------+-----+
    |Utilization (%)      |       46|    58|       22|       27|    2|
    +---------------------+---------+------+---------+---------+-----+

15. unrolling p, q, partition p, q complete, output dimension 1 = 16, input dimension 2/3 = 5, used accumualtor for output[i1][h][w], pipelined w, made h,w iteration's needed input register, permuted the i1 loop, unrolled w loop by 8.
    41104179200/209152466 = 196

    ================================================================
    == Utilization Estimates
    ================================================================
    * Summary: 
    +---------------------+---------+------+---------+---------+-----+
    |         Name        | BRAM_18K|  DSP |    FF   |   LUT   | URAM|
    +---------------------+---------+------+---------+---------+-----+
    |DSP                  |        -|     -|        -|        -|    -|
    |Expression           |        -|     -|        0|        2|    -|
    |FIFO                 |        -|     -|        -|        -|    -|
    |Instance             |       40|  8005|  1035390|   616429|    0|
    |Memory               |     2000|     -|        0|        0|   25|
    |Multiplexer          |        -|     -|        -|      104|    -|
    |Register             |        -|     -|      199|        -|    -|
    +---------------------+---------+------+---------+---------+-----+
    |Total                |     2040|  8005|  1035589|   616535|   25|
    +---------------------+---------+------+---------+---------+-----+
    |Available SLR        |     1440|  2280|   788160|   394080|  320|
    +---------------------+---------+------+---------+---------+-----+
    |Utilization SLR (%)  |      141|   351|      131|      156|    7|
    +---------------------+---------+------+---------+---------+-----+
    |Available            |     4320|  6840|  2364480|  1182240|  960|
    +---------------------+---------+------+---------+---------+-----+
    |Utilization (%)      |       47|   117|       43|       52|    2|
    +---------------------+---------+------+---------+---------+-----+